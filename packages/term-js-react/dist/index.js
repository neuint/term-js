import e,{useRef as t,useEffect as r}from"react";import n from"@neuint/term-js";import{noop as i,isArray as a}from"lodash-es";const o=(e,t)=>{const{prevHandler:r,handler:n,event:i}=t;r&&r!==n&&e.removeEventListener(i,r),n&&e.addEventListener(i,n)},u=e=>{if("string"==typeof e)return{value:{str:e}};if(void 0!==(null==e?void 0:e.str))return{value:e};if(void 0!==(null==e?void 0:e.value)){const{value:t,withSubmit:r}=e;return{withSubmit:r,value:"string"==typeof t?{str:t}:t}}},s=(e,t)=>{const r=(e=>{if(void 0===(null==e?void 0:e.data))return[u(e)];const{duration:t,data:r}=e,n=a(r)?r.map(u):[u(r)],i=t?n.reduce(((e,t)=>e+t.value.str.length),0):0,o=t&&i?t/i:0;return n.map((e=>Object.assign(Object.assign({},e),{duration:t?e.value.str.length*o:void 0})))})(t);return new Promise((t=>{const n=()=>{const i=r.shift();if(!i)return void t(void 0);const a=e.write(i.value,{duration:i.duration,withSubmit:i.withSubmit});a instanceof Promise?a.then(n):n()};n()}))},d=a=>{const{className:u,label:d,header:l,delimiter:v,onSubmit:c,onChange:m,initLines:h=[],secret:f=!1,initValue:b,onWritten:p=i,write:g}=a,w=t(),L=t(),S=t({onSubmit:c,onChange:m}),E=t(void 0);return r((()=>{const{current:e}=L;e?(e.header=l,e.setLabel({label:d,delimiter:v}),((e,t)=>{e.secret!==t&&(e.value="",e.secret=t)})(e,f),o(e,{event:"submit",handler:c,prevHandler:S.current.onSubmit}),o(e,{event:"change",handler:m,prevHandler:S.current.onChange})):(L.current=new n(w.current,{label:d,header:l,lines:h,virtualizedTopOffset:400,virtualizedBottomOffset:400,editLine:{secret:f,value:b}}),c&&L.current.addEventListener("submit",c),m&&L.current.addEventListener("change",m))}),[b,f,l,d,v,c,m,h]),r((()=>()=>{var e;null===(e=L.current)||void 0===e||e.destroy()}),[]),r((()=>{void 0===E.current&&void 0!==g&&(E.current=g,s(L.current,g).then((()=>{E.current=void 0,p()})))}),[p,g]),e.createElement("div",{ref:w,className:u})};export{d as default};
