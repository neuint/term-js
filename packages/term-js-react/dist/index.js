import e,{useRef as t,useState as r,useEffect as n,Children as i}from"react";import{isArray as a,noop as u}from"lodash-es";import o from"@neuint/term-js";const d=e=>{if("string"==typeof e)return{value:{str:e}};if(void 0!==(null==e?void 0:e.str))return{value:e};if(void 0!==(null==e?void 0:e.value)){const{value:t,withSubmit:r}=e;return{withSubmit:r,value:"string"==typeof t?{str:t}:t}}},l=(e,t)=>{const r=(e=>{if(void 0===(null==e?void 0:e.data))return[d(e)];const{duration:t,data:r}=e,n=a(r)?r.map(d):[d(r)],i=t?n.reduce(((e,t)=>e+t.value.str.length),0):0,u=t&&i?t/i:0;return n.map((e=>Object.assign(Object.assign({},e),{duration:t?e.value.str.length*u:void 0})))})(t);return new Promise((t=>{const n=()=>{const i=r.shift();if(!i)return void t(void 0);const a=e.write(i.value,{duration:i.duration,withSubmit:i.withSubmit});a instanceof Promise?a.then(n):n()};n()}))},s=(e,t)=>{const{prevHandler:r,handler:n,event:i}=t;r&&r!==n&&e.removeEventListener(i,r),n&&e.addEventListener(i,n)},c=a=>{const{className:d,label:c,header:v="",delimiter:m,onSubmit:h,onChange:b,initLines:f=[],secret:p=!1,initValue:g,onWritten:w=u,write:L,children:S,disabled:E=!1}=a,O=t(),[j,y]=r(!1),C=t(),H=t({onSubmit:h,onChange:b}),z=t(void 0);return n((()=>{C.current&&C.current.disabled!==E&&(C.current.disabled=E)}),[E]),n((()=>{const{current:e}=C;e?(e.header=v,e.setLabel({label:c,delimiter:m}),((e,t)=>{e.secret!==t&&(e.value="",e.secret=t)})(e,p),s(e,{event:"submit",handler:h,prevHandler:H.current.onSubmit}),s(e,{event:"change",handler:b,prevHandler:H.current.onChange})):(C.current=new o(O.current,{label:c,header:v,lines:f,virtualizedTopOffset:400,virtualizedBottomOffset:400,editLine:{secret:p,value:g}}),h&&C.current.addEventListener("submit",h),b&&C.current.addEventListener("change",b),y(!0))}),[g,p,v,c,m,h,b,f]),n((()=>()=>{var e;null===(e=C.current)||void 0===e||e.destroy(),C.current=void 0}),[]),n((()=>{void 0===z.current&&void 0!==L&&(z.current=L,l(C.current,L).then((()=>{z.current=void 0,w()})))}),[w,L]),e.createElement("div",{ref:O,className:d},S&&C.current&&j?i.map(S,(t=>e.cloneElement(t,{term:C.current}))):null)};export{c as default};
